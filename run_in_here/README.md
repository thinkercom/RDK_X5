# 🌱 智慧农业设备控制与可视化平台

## 📖 项目简介

本项目基于 Flask + OpenCV，集成了摄像头实时检测、设备自动控制（如水泵、滑台、底盘）、Web 可视化管理等功能。系统支持多摄像头切换、目标中心区判定、设备状态自动管理、图片自动保存等，适用于智能农业、自动化巡检等场景。

---

## 📁 目录结构与模块说明

```
run_in_here/
├── README.md           # 项目说明文档（本文件）
├── config.py           # 全局参数与枚举配置，如中心区参数、设备状态等
├── device.py           # 设备与串口通信相关，底层硬件交互、设备状态管理
├── main.py             # 项目主入口，启动Flask Web服务
├── model.py            # 目标检测模型加载与推理（如YOLO11等）
├── templates/          # 前端HTML模板（如intro.html、index4.html、about.html等）
├── utils.py            # 通用工具函数，包括状态滤波、图片保存、图像预处理等
├── webapp.py           # Web业务主文件，定义所有路由、视频流主循环、页面渲染、摄像头切换等
```

### 主要模块说明
- **config.py**：集中管理所有全局参数、常量、枚举类型，便于统一修改和维护。
- **device.py**：实现与硬件设备（如水泵、滑台、底盘等）的串口通信，包含设备状态的读取与控制方法。
- **model.py**：封装目标检测模型的加载与推理接口，支持摄像头画面实时分析。
- **utils.py**：提供如图片保存、状态滤波、图像预处理、检测结果绘制等通用工具。
- **webapp.py**：核心Web后端，定义所有Flask路由，包括视频流、页面渲染、摄像头切换、设备控制等。
- **templates/**：存放所有前端页面模板，支持Jinja2语法，便于动态渲染。
- **main.py**：项目启动入口，通常只需运行此文件即可启动整个系统。

---

## 🚀 主要功能

- **实时目标检测与设备控制**  
  - 支持摄像头画面实时检测与分析，自动识别目标物体
  - 自动控制水泵、滑台、底盘等设备，实现智能联动
  - 多摄像头切换，适应不同场景需求
  - 中心区判定与偏移，适应实际喷头与摄像头高度差
  - 检测图片自动保存，便于溯源与分析
- **Web可视化管理**  
  - 通过网页实时查看视频流、设备状态、切换摄像头
  - 设备控制、参数调整、状态监控一站式操作
  - 页面美观，操作便捷，支持多端访问

---

## 🛠️ 依赖环境

- Python 3.8+
- Flask
- OpenCV (`opencv-python`)
- numpy
- 其它依赖见 requirements.txt

**硬件依赖：**
- 摄像头（支持USB/板载摄像头）
- 串口设备（如水泵、滑台等）
- 底盘（如有移动底盘需求）

---

## ⚡ 快速启动

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **配置参数**
   - 根据实际硬件情况，修改 `config.py`、`device.py`、`model.py` 中的相关参数（如串口号、设备ID、模型路径、中心区参数等）。
   - 检查 `templates/` 目录下有 intro.html、index4.html、about.html 等页面文件。

3. **运行项目**
   ```bash
   cd run_in_here
   python main.py
   ```
   默认服务运行在 `0.0.0.0:5000`，浏览器访问 `http://localhost:5000/start` 进入主页面。

---

## 🧩 典型使用流程

1. 启动系统后，浏览器访问 `/start` 进入主页面。
2. 实时查看摄像头画面，系统自动检测目标并联动设备。
3. 可通过页面按钮切换摄像头、调整参数、手动控制设备等。
4. 检测图片会自动保存，便于后续分析。
5. 如需退出系统，可点击右上角“退出系统”按钮。

---

## ⚙️ 配置说明

- **串口号/设备ID**：在 `device.py` 中配置，需与实际硬件一致。
- **中心区参数**：在 `config.py` 中配置，影响目标判定与设备联动。
- **模型路径**：如有AI模型推理需求，在 `model.py` 中配置。
- **页面模板**：如需自定义前端页面，可在 `templates/` 目录下修改对应HTML文件。

---

## ❓ 常见问题与排查

- **页面报错/功能异常**  
  - 检查依赖是否安装齐全，相关目录有无读写权限。
  - 检查 `templates/` 目录下是否有对应的 HTML 文件。
- **摄像头/串口无法打开**  
  - 请确认硬件已连接，路径和权限正确。
  - 检查 `device.py`、`config.py` 中的串口号、设备ID 是否正确。
- **视频流卡顿/延迟**  
  - 检查摄像头带宽，或尝试降低分辨率。
- **图片未保存**  
  - 检查图片保存目录权限。

---

## 📷 示例界面

> 可在 `templates/` 目录下自定义页面风格，支持Jinja2变量渲染。
> 
> ![系统主页面示意图](示例图片路径/your_screenshot.png)

---

## 📬 联系与支持

如有问题或定制需求，请联系项目维护者。

---

**✨ 祝你使用愉快，助力智慧农业！✨** 